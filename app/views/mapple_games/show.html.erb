<% session[:country_letters] = Array.new(@mapple_game.country.name.length, '_') unless session.key?(:country_letters) %>


<div class="d-flex flex-column justify-content-center align-items-center vh-100">

  <div>
    <h1>
      <% split = @mapple_game.country.name.split('') %>
      <% randnum = rand(0..split.length) %>
      <% split.each_with_index do |letter, i| %>
        <% if i + 2 < @counter && i == randnum %>
          <% session[:country_letters][i] = letter %>
        <% end %>
      <% end %>

      <% session[:country_letters].each do |item| %>
        <% if item == '_' %>
          <span class="MappleBox"></span>
        <% else %>
          <%= item %>
        <% end %>
      <% end %>
    </h1>
  </div>

  <div class="MappleContainer">
    <h3><%= @question %></h5>
  </div>

  <div class="mt-3">
    <%= form_with url: mapple_game_path(@mapple_game), method: :get do |f| %>
      <%= f.text_field :query, autocomplete: 'off', placeholder: "guess a country!", data: { insert_question_target: "input" }, class: "MappleGuess", autofocus: true %>
      <%= f.hidden_field :counter, value: @counter %>
      <div class="d-flex flex-column justify-content-center align-items-center mt-2">
        <%= f.submit 'guess', class: 'MappleGuessButton' %>
      </div>
    <% end %>

    <div data-controller="flag">
      <% if @flag_image_url.present? %>
        <div class="mt-3" style="display: flex; flex-direction: column; align-items: center; text-align: center;">
          <button data-action="click->flag#toggleImage" class="MappleGuessButton">hint?</button>
          <img src="<%= @flag_image_url %>" alt="Flag Image" style="max-width: 200px; height: auto;" data-flag-target="image" class="data-disabled rounded">
        </div>
      <% end %>
    </div>
  </div>

  <% @mapple_game.score -= @questions[@counter].difficulty if @guess && @guess != @mapple_game.country.name %>
  <% @mapple_game.save %>
  <%= @right_answer if @right_answer %>

</div>
